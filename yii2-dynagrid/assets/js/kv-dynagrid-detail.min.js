/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.4.1
 *
 * JQuery Plugin for yii2-dynagridDetail. Allows saving/deleting the dynagridDetail 
 * filter or sort details.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var t=function(t,n){return null===t||void 0===t||t==[]||""===t||n&&""===e.trim(t)},n=function(t,n){this.$element=e(t),this.submitMessage=n.submitMessage,this.deleteMessage=n.deleteMessage,this.deleteConfirmation=n.deleteConfirmation,this.configUrl=n.configUrl,this.modalId=n.modalId,this.init(),this.listen()};n.prototype={constructor:n,init:function(){{var t=this;e("#"+t.modalId)}t.$form=t.$element.closest("form"),t.$formContainer=t.$form.parent();var n=t.$form;t.$btnSave=n.find(".dynagrid-detail-save"),t.$btnDelete=n.find(".dynagrid-detail-delete"),t.$list=n.find(".dynagrid-detail-list"),t.$name=n.find(".dynagrid-detail-name")},process:function(t){var n=this;e.ajax({type:"post",url:t,dataType:"json",data:n.$form.serialize(),beforeSend:function(){n.$form.hide(),n.$formContainer.prepend(n.submitMessage)},success:function(e){"success"==e.status&&n.$formContainer.html(e.content)}})},listen:function(){var n=this,i=n.$form,a=n.$formContainer,s=n.$list;n.$btnSave.on("click",function(){i.hide(),a.prepend(n.submitMessage),setTimeout(function(){i.submit()},1e3)}),n.$btnDelete.on("click",function(){if(t(n.$element.val()))return void i.trigger("reset.yiiActiveForm");if(confirm(n.deleteConfirmation)){var e=i.find('input[name="deleteDetailFlag"]');e.val(1),i.hide(),a.prepend(n.deleteMessage),setTimeout(function(){i.submit()},1e3)}}),s.on("change",function(){var a=s.val(),o=s.find("option:selected").text();t(a)||(n.$element.val(a),n.$name.val(o),e.ajax({type:"post",url:n.configUrl,dataType:"json",data:n.$form.serialize(),success:function(e){i.find(".dynagrid-settings-text");"success"==e.status&&i.find(".dynagrid-settings-text").html(e.content)}}))}),i.on("afterValidate",function(e,t){for(var n in t)if(t[n].length>0)return i.show(),void a.find(".dynagrid-submit-message").remove()})}},e.fn.dynagridDetail=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var a=e(this),s=a.data("dynagridDetail"),o="object"==typeof t&&t;s||a.data("dynagridDetail",s=new n(this,e.extend({},e.fn.dynagridDetail.defaults,o,e(this).data()))),"string"==typeof t&&s[t].apply(s,i)})},e.fn.dynagridDetail.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"Are you sure you want to delete all your grid personalization settings?",configUrl:"",modalId:""}}(jQuery);