/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.4.1
 *
 * JQuery Plugin for yii2-dynagrid.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var i=function(i,t){return null===i||void 0===i||i==[]||""===i||t&&""===e.trim(i)},t=function(e){var i=e.attr("name");return i.toLowerCase().replace(/-/g,"_")+"_activeform"},n=function(e){var n=e.closest("form"),s=n.data("yiiActiveForm"),o=t(e);i(o)||i(s)||(window[o]=s)},s=function(i,t){this.$element=e(i),this.submitMessage=t.submitMessage,this.deleteMessage=t.deleteMessage,this.deleteConfirmation=t.deleteConfirmation,this.modalId=t.modalId,this.init(),this.listen()};s.prototype={constructor:s,init:function(){var s=this,o=e("#"+s.modalId),l=t(s.$element),d=s.$element.closest("form");s.$form=d,i(window[l])&&n(s.$element),s.$visibleEl=d.find(".sortable-visible"),s.$hiddenEl=d.find(".sortable-hidden"),s.$visibleKeys=d.find('input[name="visibleKeys"]'),s.$btnSubmit=o.find(".dynagrid-submit"),s.$btnDelete=o.find(".dynagrid-delete"),s.$btnReset=o.find(".dynagrid-reset"),s.$formContainer=d.parent(),s.setColumnKeys(),s.visibleContent=s.$visibleEl.html(),s.hiddenContent=s.$hiddenEl.html(),s.visibleSortableOptions=window[s.$visibleEl.data("pluginOptions")],s.hiddenSortableOptions=window[s.$hiddenEl.data("pluginOptions")]},listen:function(){{var e=this,i=e.$form,t=e.$formContainer;e.$form.data("yiiActiveForm")}e.$btnSubmit.on("click",function(){e.setColumnKeys(),e.$visibleKeys.val(e.visibleKeys),i.hide(),t.prepend(e.submitMessage),setTimeout(function(){i.submit()},1e3)}),e.$btnDelete.on("click",function(){if(confirm(e.deleteConfirmation)){var n=i.find('input[name="deleteFlag"]');n.val(1),i.hide(),t.prepend(e.deleteMessage),setTimeout(function(){i.submit()},1e3)}}),e.$btnReset.on("click",function(){e.$visibleEl.html(e.visibleContent),e.$hiddenEl.html(e.hiddenContent),e.setColumnKeys(),t.find(".dynagrid-submit-message").remove(),e.$visibleEl.sortable(e.visibleSortableOptions),e.$hiddenEl.sortable(e.hiddenSortableOptions),i.trigger("reset.yiiActiveForm")}),i.on("afterValidate",function(e,n){for(var s in n)if(n[s].length>0)return i.show(),void t.find(".dynagrid-submit-message").remove()})},reset:function(){var n,s,o=this,l=o.$element.closest("form");o.$visibleEl.html(o.visibleContent),o.$hiddenEl.html(o.hiddenContent),o.setColumnKeys(),o.$formContainer.find(".dynagrid-submit-message").remove(),o.$visibleEl.sortable(o.visibleSortableOptions),o.$hiddenEl.sortable(o.hiddenSortableOptions),arguments.length&&arguments[0]&&(n=t(o.$element),s=window[n],i(s)||(l.yiiActiveForm("destroy"),l.yiiActiveForm(s.attributes,s.settings)),l.find("select").each(function(){var t=e(this),n=t.attr("id"),s=t.data("pluginOptions");i(s)||jQuery.when(t.select2(window[s])).done(initSelect2Loading(n))}))},setColumnKeys:function(){var i=this;i.visibleKeys=i.$visibleEl.find("li").map(function(i,t){return e(t).attr("id")}).get().join(",")}},e.fn.dynagrid=function(i){var t=Array.apply(null,arguments);return t.shift(),this.each(function(){var n=e(this),o=n.data("dynagrid"),l="object"==typeof i&&i;o||n.data("dynagrid",o=new s(this,e.extend({},e.fn.dynagrid.defaults,l,e(this).data()))),"string"==typeof i&&o[i].apply(o,t)})},e.fn.dynagrid.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"Are you sure you want to delete all your grid personalization settings?",modalId:""}}(jQuery);